<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.118.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon.png><meta itemprop=name content="CF207C"><meta itemprop=description content="QwQ"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://myeeye.github.io/imgs/myee.png"><meta itemprop=keywords content="题解,CF,图片挂了"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.7a8fc2f048a9a1f73e4007207273268b75305a9c5710fd1fead4a1e33219fa26.css><style type=text/css>.post-footer hr:after,.flinks-list-footer hr:after{content:"~ QwQ ~"}</style><link rel=stylesheet type=text/css href=/css/custom_style.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"cf207c","permalink":"https://myeeye.github.io/post/cf207c/","title":"CF207C","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://npm.elemecdn.com/penndu@1.0.0/bsz.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>CF207C - myee's blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>myee's blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>And in that light...</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>37</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tag hvr-icon"></i>标签</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友情链接</a></li><li class="menu-item menu-item-random"><a href=/random.html class=hvr-icon-pulse rel=section><i class="fa fa-random hvr-icon"></i>随机页面</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#前言>前言</a></li><li><a href=#code>Code</a></li><li><a href=#思路>思路</a></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=myee src=/imgs/img-lazy-loading.gif data-src=/imgs/myee.png><p class=site-author-name itemprop=name>myee</p><div class=site-description itemprop=description>QwQ</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>37</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>10</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=mailto:myeeye@qq.com title="邮箱 → mailto:myeeye@qq.com" rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>
邮箱</a></span>
<span class=links-of-social-item><a href=https://www.luogu.com.cn/user/105050 title="洛谷 → https://www.luogu.com.cn/user/105050" rel=noopener target=_blank><i class="fa fa-wifi fa-fw"></i>
洛谷</a></span>
<span class=links-of-social-item><a href=https://github.com/myeeye title="GitHub → https://github.com/myeeye" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>
GitHub</a></span>
<span class=links-of-social-item><a href=https://www.zhihu.com/people/myeeye title="知乎 → https://www.zhihu.com/people/myeeye" rel=noopener target=_blank><i class="fab fa-zhihu fa-fw"></i>
知乎</a></span></div><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:var(--text-color)}</style></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=84858></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=185></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><a role=button class="book-mark-link book-mark-link-fixed"></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://myeeye.github.io/post/cf207c/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/myee.png"><meta itemprop=name content="myee"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="myee"><meta itemprop=description content="QwQ"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="CF207C"><meta itemprop=description content="前言

学习 

    zzd 博客
    
（"></span><header class=post-header><h1 class=post-title itemprop="name headline">CF207C</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=发表于>发表于：</span>
<time title="创建时间：2023-02-15 16:33:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2023-02-15 16:33:00 +0800 CST">2023-02-15</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i></span>
<span class=post-meta-item-text title=更新于>更新于：</span>
<time title=修改时间：2023-02-15T16:35:00+08:00 itemprop=dateModified datetime=2023-02-15T16:35:00+08:00>2023-02-15</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text title=分类于>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E9%A2%98%E8%A7%A3 itemprop=url rel=index><span itemprop=name>题解</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span>
<span>1039</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>3分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/cf207c/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><h3 id=前言>前言
<a class=header-anchor href=#%e5%89%8d%e8%a8%80></a></h3><p>学习
<a href=https://cmxrynp.blog.uoj.ac/blog/6233 title="zzd 博客">zzd 博客
</a>（</p><blockquote><p>这题超级没有素质。</p><p>连个题解都搜不到。</p><p>好不容易搜到一个。</p><p>看了一下是 pascal。</p><p>不过还好我有办法。</p><p>树剖做 $k$ 级祖先。</p><p>十万的俩老哥飘过。</p><p>三百毫秒优异成绩。</p><p>哇哈哈哈哈哈哈哈。</p><p>接下来该放代码了。</p><p>做法描述在代码后。</p></blockquote><p><img src=/imgs/img-lazy-loading.gif data-src=./imgs/smile.png alt=img></p><h3 id=code>Code
<a class=header-anchor href=#code></a></h3><p>这个能做到 $n_1,n_2\le300000$ 的情况。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>  1</a></span><span>uint FathA[<span style=color:#ae81ff>300005</span>],FathB[<span style=color:#ae81ff>300005</span>],SA[<span style=color:#ae81ff>300005</span>],Rank[<span style=color:#ae81ff>300005</span>],tp1,tp2;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>  2</a></span><span>chr C_A[<span style=color:#ae81ff>300005</span>],C_B[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>  3</a></span><span>voi <span style=color:#a6e22e>build</span>(){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>  4</a></span><span>    <span style=color:#66d9ef>static</span> uint Fath[<span style=color:#ae81ff>300005</span>],Fath2[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>  5</a></span><span>    uint n<span style=color:#f92672>=</span>tp2;<span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Fath[i]<span style=color:#f92672>=</span>FathB[i],SA[i]<span style=color:#f92672>=</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6>  6</a></span><span>    std<span style=color:#f92672>::</span>sort(SA,SA<span style=color:#f92672>+</span>n,[<span style=color:#f92672>&amp;</span>](uint a,uint b){<span style=color:#66d9ef>return</span> C_B[a]<span style=color:#f92672>&lt;</span>C_B[b];});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7>  7</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Rank[SA[i]]<span style=color:#f92672>=</span>i<span style=color:#f92672>&amp;&amp;</span>C_B[SA[i]]<span style=color:#f92672>==</span>C_B[SA[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]]<span style=color:#f92672>?</span>Rank[SA[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]]<span style=color:#f92672>:</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8>  8</a></span><span>    <span style=color:#66d9ef>for</span>(uint len<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;len<span style=color:#f92672>&lt;</span>n;len<span style=color:#f92672>&lt;&lt;=</span><span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9>  9</a></span><span>        <span style=color:#66d9ef>static</span> std<span style=color:#f92672>::</span>pair<span style=color:#f92672>&lt;</span>uint,uint<span style=color:#f92672>&gt;</span>W[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10> 10</a></span><span>        bol ok<span style=color:#f92672>=</span>true;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11> 11</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12> 12</a></span><span>            W[i]<span style=color:#f92672>=</span>{Rank[i],<span style=color:#f92672>~</span>Fath[i]<span style=color:#f92672>?</span>Rank[Fath[i]]<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0u</span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13> 13</a></span><span>            <span style=color:#66d9ef>if</span>(<span style=color:#f92672>~</span>Fath[i])Fath2[i]<span style=color:#f92672>=</span>Fath[Fath[i]],ok<span style=color:#f92672>=</span>false;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14> 14</a></span><span>            <span style=color:#66d9ef>else</span> Fath2[i]<span style=color:#f92672>=</span>Fath[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15> 15</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16> 16</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Fath[i]<span style=color:#f92672>=</span>Fath2[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17> 17</a></span><span>        <span style=color:#66d9ef>if</span>(ok)<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18> 18</a></span><span>        <span style=color:#66d9ef>static</span> uint Cnt[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19> 19</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;=</span>n;i<span style=color:#f92672>++</span>)Cnt[i]<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20> 20</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Cnt[W[i].second]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21> 21</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;i<span style=color:#f92672>&lt;=</span>n;i<span style=color:#f92672>++</span>)Cnt[i]<span style=color:#f92672>+=</span>Cnt[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22> 22</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span>n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;<span style=color:#f92672>~</span>i;i<span style=color:#f92672>--</span>)Rank[<span style=color:#f92672>--</span>Cnt[W[i].second]]<span style=color:#f92672>=</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23> 23</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Cnt[i]<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24> 24</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Cnt[W[i].first]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25> 25</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Cnt[i]<span style=color:#f92672>+=</span>Cnt[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26> 26</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span>n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;<span style=color:#f92672>~</span>i;i<span style=color:#f92672>--</span>)SA[<span style=color:#f92672>--</span>Cnt[W[Rank[i]].first]]<span style=color:#f92672>=</span>Rank[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27> 27</a></span><span>        <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Rank[SA[i]]<span style=color:#f92672>=</span>i<span style=color:#f92672>&amp;&amp;</span>W[SA[i]]<span style=color:#f92672>==</span>W[SA[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]]<span style=color:#f92672>?</span>Rank[SA[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]]<span style=color:#f92672>:</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28> 28</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29> 29</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)SA[i]<span style=color:#f92672>=</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30> 30</a></span><span>    std<span style=color:#f92672>::</span>sort(SA,SA<span style=color:#f92672>+</span>n,[<span style=color:#f92672>&amp;</span>](uint a,uint b){<span style=color:#66d9ef>return</span> Rank[a]<span style=color:#f92672>&lt;</span>Rank[b];});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31> 31</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Rank[SA[i]]<span style=color:#f92672>=</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32> 32</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33> 33</a></span><span>uint Siz[<span style=color:#ae81ff>300005</span>],Heavy[<span style=color:#ae81ff>300005</span>],Dep[<span style=color:#ae81ff>300005</span>],Rot[<span style=color:#ae81ff>300005</span>],Dfn[<span style=color:#ae81ff>300005</span>],Back[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34> 34</a></span><span>voi <span style=color:#a6e22e>build2</span>(){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35> 35</a></span><span>    <span style=color:#66d9ef>static</span> std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>uint<span style=color:#f92672>&gt;</span>Son[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36> 36</a></span><span>    <span style=color:#66d9ef>static</span> uint Fath[<span style=color:#ae81ff>300005</span>],Cur[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-37> 37</a></span><span>    uint n<span style=color:#f92672>=</span>tp2;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-38> 38</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Fath[i]<span style=color:#f92672>=</span>FathB[i],Heavy[i]<span style=color:#f92672>=</span>Rot[i]<span style=color:#f92672>=</span>Cur[i]<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>,Siz[i]<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-39> 39</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;i<span style=color:#f92672>&lt;</span>n;i<span style=color:#f92672>++</span>)Dep[i]<span style=color:#f92672>=</span>Dep[Fath[i]]<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>,Son[Fath[i]].push_back(i);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-40> 40</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span>n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;i;i<span style=color:#f92672>--</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-41> 41</a></span><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!~</span>Heavy[Fath[i]]<span style=color:#f92672>||</span>Siz[Heavy[Fath[i]]]<span style=color:#f92672>&lt;</span>Siz[i])Heavy[Fath[i]]<span style=color:#f92672>=</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-42> 42</a></span><span>        Siz[Fath[i]]<span style=color:#f92672>+=</span>Siz[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-43> 43</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-44> 44</a></span><span>    std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>uint<span style=color:#f92672>&gt;</span>P{<span style=color:#ae81ff>0</span>};uint cnt<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-45> 45</a></span><span>    <span style=color:#66d9ef>while</span>(P.size()){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-46> 46</a></span><span>        uint p<span style=color:#f92672>=</span>P.back();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-47> 47</a></span><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!~</span>Rot[p])Rot[p]<span style=color:#f92672>=</span>p;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-48> 48</a></span><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!~</span>Cur[p]){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-49> 49</a></span><span>            Cur[p]<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,Back[Dfn[p]<span style=color:#f92672>=</span>cnt<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span>p;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-50> 50</a></span><span>            <span style=color:#66d9ef>if</span>(<span style=color:#f92672>~</span>Heavy[p]){Rot[Heavy[p]]<span style=color:#f92672>=</span>Rot[p],P.push_back(Heavy[p]);<span style=color:#66d9ef>continue</span>;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-51> 51</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-52> 52</a></span><span>        <span style=color:#66d9ef>while</span>(Cur[p]<span style=color:#f92672>&lt;</span>Son[p].size()<span style=color:#f92672>&amp;&amp;</span>Son[p][Cur[p]]<span style=color:#f92672>==</span>Heavy[p])Cur[p]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-53> 53</a></span><span>        <span style=color:#66d9ef>if</span>(Cur[p]<span style=color:#f92672>==</span>Son[p].size()){P.pop_back();<span style=color:#66d9ef>continue</span>;}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-54> 54</a></span><span>        P.push_back(Son[p][Cur[p]<span style=color:#f92672>++</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-55> 55</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-56> 56</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-57> 57</a></span><span>chr <span style=color:#a6e22e>kthFath</span>(uint p,uint d){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-58> 58</a></span><span>    <span style=color:#66d9ef>if</span>(d<span style=color:#f92672>&gt;=</span>Dep[p])<span style=color:#66d9ef>return</span><span style=color:#e6db74>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-59> 59</a></span><span>    <span style=color:#66d9ef>while</span>(Dfn[p]<span style=color:#f92672>-</span>Dfn[Rot[p]]<span style=color:#f92672>&lt;</span>d)d<span style=color:#f92672>-=</span>Dfn[p]<span style=color:#f92672>-</span>Dfn[Rot[p]]<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>,p<span style=color:#f92672>=</span>FathB[Rot[p]];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-60> 60</a></span><span>    <span style=color:#66d9ef>return</span> C_B[Back[Dfn[p]<span style=color:#f92672>-</span>d]];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-61> 61</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-62> 62</a></span><span>uint L[<span style=color:#ae81ff>300005</span>],R[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-63> 63</a></span><span>voi <span style=color:#a6e22e>build3</span>(){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-64> 64</a></span><span>    <span style=color:#66d9ef>static</span> uint Dep[<span style=color:#ae81ff>300005</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-65> 65</a></span><span>    L[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,R[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=</span>tp2,Dep[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-66> 66</a></span><span>    <span style=color:#66d9ef>for</span>(uint p<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;p<span style=color:#f92672>&lt;</span>tp1;p<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-67> 67</a></span><span>        Dep[p]<span style=color:#f92672>=</span>Dep[FathA[p]]<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-68> 68</a></span><span>        uint l<span style=color:#f92672>=</span>L[FathA[p]],r<span style=color:#f92672>=</span>R[FathA[p]];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-69> 69</a></span><span>        <span style=color:#66d9ef>while</span>(l<span style=color:#f92672>&lt;</span>r){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-70> 70</a></span><span>            uint mid<span style=color:#f92672>=</span>(l<span style=color:#f92672>+</span>r)<span style=color:#f92672>&gt;&gt;</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-71> 71</a></span><span>            <span style=color:#66d9ef>if</span>(kthFath(SA[mid],Dep[p])<span style=color:#f92672>&gt;=</span>C_A[p])r<span style=color:#f92672>=</span>mid;<span style=color:#66d9ef>else</span> l<span style=color:#f92672>=</span>mid<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-72> 72</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-73> 73</a></span><span>        L[p]<span style=color:#f92672>=</span>l;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-74> 74</a></span><span>        r<span style=color:#f92672>=</span>R[FathA[p]];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-75> 75</a></span><span>        <span style=color:#66d9ef>while</span>(l<span style=color:#f92672>&lt;</span>r){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-76> 76</a></span><span>            uint mid<span style=color:#f92672>=</span>(l<span style=color:#f92672>+</span>r)<span style=color:#f92672>&gt;&gt;</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-77> 77</a></span><span>            <span style=color:#66d9ef>if</span>(kthFath(SA[mid],Dep[p])<span style=color:#f92672>&gt;</span>C_A[p])r<span style=color:#f92672>=</span>mid;<span style=color:#66d9ef>else</span> l<span style=color:#f92672>=</span>mid<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-78> 78</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-79> 79</a></span><span>        R[p]<span style=color:#f92672>=</span>l;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-80> 80</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-81> 81</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-82> 82</a></span><span><span style=color:#66d9ef>namespace</span> BIT1{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-83> 83</a></span><span>    <span style=color:#66d9ef>const</span> uint Lim<span style=color:#f92672>=</span><span style=color:#ae81ff>400000</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-84> 84</a></span><span>    ullt B[Lim<span style=color:#f92672>+</span><span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-85> 85</a></span><span>    voi <span style=color:#a6e22e>add</span>(uint p,ullt v){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-86> 86</a></span><span>        p<span style=color:#f92672>++</span>;<span style=color:#66d9ef>while</span>(p<span style=color:#f92672>&lt;=</span>Lim)B[p]<span style=color:#f92672>+=</span>v,p<span style=color:#f92672>+=</span>lowbit(p);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-87> 87</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-88> 88</a></span><span>    ullt <span style=color:#a6e22e>find</span>(uint l,uint r){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-89> 89</a></span><span>        ullt ans<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-90> 90</a></span><span>        <span style=color:#66d9ef>while</span>(r)ans<span style=color:#f92672>+=</span>B[r],r<span style=color:#f92672>-=</span>lowbit(r);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-91> 91</a></span><span>        <span style=color:#66d9ef>while</span>(l)ans<span style=color:#f92672>-=</span>B[l],l<span style=color:#f92672>-=</span>lowbit(l);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-92> 92</a></span><span>        <span style=color:#66d9ef>return</span> ans;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-93> 93</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-94> 94</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-95> 95</a></span><span><span style=color:#66d9ef>namespace</span> BIT2{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-96> 96</a></span><span>    <span style=color:#66d9ef>const</span> uint Lim<span style=color:#f92672>=</span><span style=color:#ae81ff>400000</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-97> 97</a></span><span>    ullt B[Lim<span style=color:#f92672>+</span><span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-98> 98</a></span><span>    voi <span style=color:#a6e22e>add</span>(uint l,uint r,ullt v){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-99> 99</a></span><span>        l<span style=color:#f92672>++</span>,r<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-100>100</a></span><span>        <span style=color:#66d9ef>while</span>(l<span style=color:#f92672>&lt;=</span>Lim)B[l]<span style=color:#f92672>+=</span>v,l<span style=color:#f92672>+=</span>lowbit(l);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-101>101</a></span><span>        <span style=color:#66d9ef>while</span>(r<span style=color:#f92672>&lt;=</span>Lim)B[r]<span style=color:#f92672>-=</span>v,r<span style=color:#f92672>+=</span>lowbit(r);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-102>102</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-103>103</a></span><span>    ullt <span style=color:#a6e22e>find</span>(uint p){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-104>104</a></span><span>        p<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-105>105</a></span><span>        ullt ans<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-106>106</a></span><span>        <span style=color:#66d9ef>while</span>(p)ans<span style=color:#f92672>+=</span>B[p],p<span style=color:#f92672>-=</span>lowbit(p);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-107>107</a></span><span>        <span style=color:#66d9ef>return</span> ans;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-108>108</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-109>109</a></span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-110>110</a></span><span>uint Op[<span style=color:#ae81ff>600005</span>];ullt Ans[<span style=color:#ae81ff>600006</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-111>111</a></span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-112><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-112>112</a></span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-113><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-113>113</a></span><span>    uint q;scanf(<span style=color:#e6db74>&#34;%u&#34;</span>,<span style=color:#f92672>&amp;</span>q);Op[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,Op[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>,tp1<span style=color:#f92672>=</span>tp2<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,q<span style=color:#f92672>+=</span><span style=color:#ae81ff>2</span>,FathA[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=</span>FathB[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-114><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-114>114</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>;i<span style=color:#f92672>&lt;</span>q;i<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-115><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-115>115</a></span><span>        scanf(<span style=color:#e6db74>&#34;%u&#34;</span>,Op<span style=color:#f92672>+</span>i);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-116><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-116>116</a></span><span>        <span style=color:#66d9ef>if</span>(Op[i]<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)scanf(<span style=color:#e6db74>&#34;%u%s&#34;</span>,FathA<span style=color:#f92672>+</span>tp1,C_A<span style=color:#f92672>+</span>tp1),FathA[tp1<span style=color:#f92672>++</span>]<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-117><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-117>117</a></span><span>        <span style=color:#66d9ef>else</span> scanf(<span style=color:#e6db74>&#34;%u%s&#34;</span>,FathB<span style=color:#f92672>+</span>tp2,C_B<span style=color:#f92672>+</span>tp2),FathB[tp2<span style=color:#f92672>++</span>]<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-118><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-118>118</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-119><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-119>119</a></span><span>    build();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-120><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-120>120</a></span><span>    build2();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-121><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-121>121</a></span><span>    build3();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-122><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-122>122</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,p1<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,p2<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>q;i<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-123><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-123>123</a></span><span>        <span style=color:#66d9ef>if</span>(Op[i]<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-124><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-124>124</a></span><span>            Ans[i]<span style=color:#f92672>=</span>BIT1<span style=color:#f92672>::</span>find(L[p1],R[p1]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-125><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-125>125</a></span><span>            BIT2<span style=color:#f92672>::</span>add(L[p1],R[p1],<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-126><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-126>126</a></span><span>            p1<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-127><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-127>127</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-128><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-128>128</a></span><span>        <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-129><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-129>129</a></span><span>            Ans[i]<span style=color:#f92672>=</span>BIT2<span style=color:#f92672>::</span>find(Rank[p2]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-130><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-130>130</a></span><span>            BIT1<span style=color:#f92672>::</span>add(Rank[p2],<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-131><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-131>131</a></span><span>            p2<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-132><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-132>132</a></span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-133><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-133>133</a></span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-134><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-134>134</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;i<span style=color:#f92672>&lt;</span>q;i<span style=color:#f92672>++</span>)Ans[i]<span style=color:#f92672>+=</span>Ans[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-135><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-135>135</a></span><span>    <span style=color:#66d9ef>for</span>(uint i<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>;i<span style=color:#f92672>&lt;</span>q;i<span style=color:#f92672>++</span>)printf(<span style=color:#e6db74>&#34;%llu</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,Ans[i]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-136><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-136>136</a></span><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-137><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-137>137</a></span><span>}
</span></span></code></pre></div><h3 id=思路>思路
<a class=header-anchor href=#%e6%80%9d%e8%b7%af></a></h3><p>考虑答案的两种描述：</p><ul><li>$t_1$ 的叶到根的路径，与 $t_2$ 的祖先往叶的路径相等。</li><li>$t_1$ 的根到叶的路径，与 $t_2$ 的叶往上的路径相等。</li></ul><p>第二种信息更好维护，考虑按第二种方式计算答案。</p><p>先假设 $t_2$ 一开始给定，不会修改。</p><p>我们考虑加 $t_1$ 中叶子的操作，如何快速查询答案变化量。</p><p>对 $t_2$ 做
<a href=https://www.luogu.com.cn/problem/P5353 title=树上后缀排序>树上后缀排序
</a>，查询操作可以描述为在后缀数组上查找一段合法的区间。</p><p>再考虑上加 $t_2$ 叶子的操作，我们把操作离线。</p><p>然后我们把每次的加 $t_1$ 叶子操作带来的贡献分为两类。</p><ol><li>其加入时带来的贡献。</li><li>其对未来的贡献。</li></ol><p>其加入时的贡献可以在后缀数组上二分找到合法区间，查询其中时间戳不大于插入时间的数的个数；同时给区间打上 “当区间内加入新节点时，对答案整体加 $1$” 的标记。</p><p>这个可以用 BIT 维护。</p><p>于是核心问题在于：如何二分？</p><p>注意到其二分的左右端点均不大于父亲，我们只用考虑新的一位带来的贡献。</p><p>这个东西就容易二分了；查找区间内向上为某位的方案数，可以用树上 $k$ 级祖先的方法快速查询。</p><p>不过如果用树剖实现 $k$ 级祖先，常数会很小，比 $O(1)$ 的长剖还要快些。</p><p>因此核心问题在于树上后缀排序，这个可能会恶心一点。</p><p>如果用后缀平衡树实现会很难写（要手写替罪羊树），而且一个不巧就爆 <code>double</code> 精度了。</p><p>直接写倍增法，即可在 $O(n\log n)$ 时间内离线建出树上后缀数组。</p><p>总复杂度 $O(n\log n)$ 或 $O(n\log^2n)$，瓶颈在二分。</p><p>空间复杂度为线性，且与字符集无关。</p><p>（听说有高明哈希做法与高明广义 SAM 做法）</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e9%a2%98%e8%a7%a3>题解</a>
<a href=/tags/cf>CF</a>
<a href=/tags/%e5%9b%be%e7%89%87%e6%8c%82%e4%ba%86>图片挂了</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
CF207C</li><li class=post-copyright-author><strong>本文作者：</strong>
myee</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://myeeye.github.io/post/cf207c/ title=CF207C>https://myeeye.github.io/post/cf207c/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/loj2839/ rel=next title=loj2839><i class="fa fa-chevron-left"></i> loj2839</a></div><div class="post-nav-prev post-nav-item"><a href=/post/abc268/ rel=prev title="ABC268 VP记">ABC268 VP记
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2023 - 2024</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>myee</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.118.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动，做出了一定的改动</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#e0e1cc","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOKQa_as4CZVPp","emit":false,"inputposition":"top","mapping":"pathname","reactions":false,"repo":"myeeye/myeeye.github.io","repoid":"R_kgDOKQa_ag","theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://myeeye.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"manual","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3"}</script><script type=text/javascript src=/js/main.min.2ae7a62913f814cac7b37958c1b62b1bc85d987f4c81e6cccffd5293f012ed2c.js defer></script></body></html>